=== Basilisk AV - Development Progress ===

Last Updated: 2025-12-18
Current Phase: 6 (UX Polish & Production Mode)
Total Features: 29
Passing: 24

---

=== Session: 2025-12-18 (Inline Visualization Integration) ===

COMPLETED:
- Imported updateWidgets from @strudel/codemirror for non-slider widget support
- Updated widget callback to handle visualization widgets (_scope, _pianoroll, etc.)
- Fixed useEffect dependency issue by using specific props (soundBrowser.isOpen, soundBrowser.stopPreview)
- Fixed test expectation for onUpdateState callback in useStrudelEngine.test.ts
- All 225 tests passing

IMPLEMENTATION DETAILS:
- Widget update callback now filters for slider vs visualization widgets
- Sliders use updateSliderWidgets(), visualizations use updateWidgets()
- @strudel/codemirror widget.mjs registers _scope, _pianoroll, _punchcard, _spiral, _pitchwheel, _spectrum
- @strudel/webaudio scope.mjs provides Pattern.prototype.scope (used by _scope widget)
- widgetPlugin already included in CodeMirror extensions

IN PROGRESS:
- None (clean state)

NEXT PRIORITY:
- p6-repl-dark-toggle: REPL theming
- Remaining Production HUD features

---

=== Session: 2025-12-17 (Strudel Slider Integration) ===

COMPLETED:
- Integrated @strudel/codemirror package (v1.2.6) for slider widgets
- Added sliderPlugin and widgetPlugin CodeMirror extensions
- Registered sliderWithID function globally for transpiler
- Added onUpdateState callback to strudelEngine for widget updates
- Implemented widget update callback in StrudelRepl component
- Verified slider() renders inline slider in editor
- Verified slider updates value in real-time
- Audio-reactive Hydra bridge (a.fft) confirmed still working
- Added 4 new features to features.json (p6-strudel-upgrade, p6-slider-widget, p6-inline-scope, p6-inline-pianoroll)
- Updated roadmap.md with Interactive Controls section
- Updated features.json with Phase 6 Interactive Controls

BLOCKERS (RESOLVED):
- Inline visualizations (._scope(), ._pianoroll()) now supported via updateWidgets()

NEXT PRIORITY:
- p6-repl-dark-toggle: REPL theming
- Remaining Production HUD features

GIT COMMITS THIS SESSION:
- (pending: strudel-slider-integration branch)

NOTES:
- slider(0.8, 0, 1, 0.1) works - inline slider renders and controls gain in real-time
- @strudel/codemirror provides sliderPlugin, widgetPlugin, updateSliderWidgets
- Widget updates flow: initStrudel → onUpdateState callback → updateSliderWidgets(view)
- Visualizations need StrudelMirror's full integration (not just side-effect imports)
- Screenshot saved: .playwright-mcp/slider-widget-test.png

---

=== Session: 2025-12-12 (Setup) ===

COMPLETED:
- Integrated Playwright MCP for Claude Code CLI
- Created .claude/settings.json with Playwright config
- Created /project:verify command for single feature verification
- Created /project:verify-all command for batch verification
- Consolidated features.json with currentPhase tracking
- Updated init.sh with phase-aware file detection
- Added User Library feature set (9 new features)
- Created USER_LIBRARY_SPEC.md with full architecture
- Extracted shared SamplePanel component design
- Created skills/playwright-verification/SKILL.md
- Updated skills/agentic-development/SKILL.md with Playwright integration
- Updated roadmap.md with Phase 6 details and User Library

IN PROGRESS:
- None (clean state)

BLOCKERS:
- None

NEXT PRIORITY:
- p6-sample-panel-base: Shared base component for Sound Browser and User Library
  (HIGH priority, no dependencies, enables both browser tracks)

SUGGESTED IMPLEMENTATION ORDER:
1. p6-sample-panel-base → Shared component
2. p6-sound-list → Sound Browser using SamplePanel
3. p6-user-library-button → Header integration  
4. p6-user-library-panel → User Library using SamplePanel
5. p6-panel-exclusivity → Mutual exclusion
6. Continue with search/preview/insert for both panels

GIT COMMITS THIS SESSION:
- (pending: phase-6-setup branch with all new files)

NOTES:
- Playwright MCP uses accessibility tree, not screenshots
- Verification steps map to Playwright actions via pattern matching
- Run `claude mcp add playwright` in project directory to enable
- Use --headless for CI, headed for debugging
- See docs/USER_LIBRARY_SPEC.md for User Library architecture
- See PLAYWRIGHT_MCP.md for verification setup
- Skills updated: agentic-development, playwright-verification (new)

---

=== Verification Workflow ===

1. Start dev server: `npm run dev`
2. In Claude Code: `/project:verify p6-sound-list`
3. Playwright navigates to localhost:5173
4. Each verification step executed and reported
5. On all-pass: features.json updated automatically

---

=== Dependency Graph (Phase 6) ===

Independent (can start now):
  - p6-sample-panel-base (HIGH) ← Start here for User Library
  - p6-sound-list (HIGH)
  - p6-shortcut-halt (HIGH) 
  - p6-shortcut-engine-start
  - p6-shortcut-hide-repl
  - p6-repl-dark-toggle
  - p6-hud-fft-bands
  - p6-hud-fps
  - p6-hud-cpu

Sound Browser Track:
  p6-sound-list
    ├── p6-sound-search
    ├── p6-sound-preview
    ├── p6-sound-toggle-button
    └── p6-sound-insert

User Library Track:
  p6-sample-panel-base
    └── p6-user-library-button
        └── p6-user-library-panel
            ├── p6-user-library-link
            ├── p6-user-library-preview (also needs p6-sound-preview)
            ├── p6-user-library-insert (also needs p6-sound-insert)
            └── p6-user-library-search (also needs p6-sound-search)

  p6-sound-list + p6-user-library-panel
    └── p6-panel-exclusivity

REPL Theming Track:
  p6-repl-dark-toggle
    └── p6-repl-syntax-theme

Keyboard Track:
  p6-shortcut-* (all three)
    └── p6-shortcut-help

HUD Track:
  p6-hud-fft-bands
    └── p6-hud-toggle
    
  p6-hud-fft-bands + p6-hud-fps
    └── p6-hud-styling
